<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安装节点 | 主神链技术文档</title>
    <meta name="description" content="所有主神联盟链中的公司, 会共同开发区块链底层功能, 每个公司专注在自己擅长或感兴趣的领域, 并开放接口及SDK给主神联盟链中的所有成员共同使用。">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.1387b97d.css" as="style"><link rel="preload" href="/assets/js/app.295daaac.js" as="script"><link rel="preload" href="/assets/js/15.ea1ac61f.js" as="script"><link rel="prefetch" href="/assets/js/10.15f96993.js"><link rel="prefetch" href="/assets/js/2.9a15e329.js"><link rel="prefetch" href="/assets/js/3.0ed1ab3f.js"><link rel="prefetch" href="/assets/js/4.d661e659.js"><link rel="prefetch" href="/assets/js/5.47999b73.js"><link rel="prefetch" href="/assets/js/6.732a0f33.js"><link rel="prefetch" href="/assets/js/7.067f464e.js"><link rel="prefetch" href="/assets/js/8.003e6c66.js"><link rel="prefetch" href="/assets/js/9.fe62e218.js"><link rel="prefetch" href="/assets/js/11.6d59fc31.js"><link rel="prefetch" href="/assets/js/12.f1319fd2.js"><link rel="prefetch" href="/assets/js/13.a651f5df.js"><link rel="prefetch" href="/assets/js/14.d4352c4d.js"><link rel="prefetch" href="/assets/js/16.abd660b2.js"><link rel="prefetch" href="/assets/js/17.2490e2d2.js"><link rel="prefetch" href="/assets/js/18.b7abab66.js"><link rel="prefetch" href="/assets/js/19.39481309.js"><link rel="prefetch" href="/assets/js/20.2b9f8a7d.js"><link rel="prefetch" href="/assets/js/21.128b6972.js"><link rel="prefetch" href="/assets/js/22.176ebccb.js"><link rel="prefetch" href="/assets/js/23.eafc5edc.js"><link rel="prefetch" href="/assets/js/24.a77288cc.js"><link rel="prefetch" href="/assets/js/25.0bfa46e4.js"><link rel="prefetch" href="/assets/js/26.e4fce782.js"><link rel="prefetch" href="/assets/js/27.da527dcf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1387b97d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">主神链技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/general/" class="nav-link">入门</a></div><div class="nav-item"><a href="/js-api/" class="nav-link">JS API</a></div><div class="nav-item"><a href="/ios-api/" class="nav-link">iOS API</a></div><div class="nav-item"><a href="/android-api/" class="nav-link">Android API</a></div><div class="nav-item"><a href="/installation/" class="nav-link router-link-active">节点安装</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/general/" class="nav-link">入门</a></div><div class="nav-item"><a href="/js-api/" class="nav-link">JS API</a></div><div class="nav-item"><a href="/ios-api/" class="nav-link">iOS API</a></div><div class="nav-item"><a href="/android-api/" class="nav-link">Android API</a></div><div class="nav-item"><a href="/installation/" class="nav-link router-link-active">节点安装</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/installation/" class="sidebar-link">节点安装手册</a></li><li><a href="/installation/install.html" class="active sidebar-link">安装节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/installation/install.html#部署架构" class="sidebar-link">部署架构</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#准备工作" class="sidebar-link">准备工作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/installation/install.html#主机需求" class="sidebar-link">主机需求</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#系统需求" class="sidebar-link">系统需求</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#申请成为出块会员" class="sidebar-link">申请成为出块会员</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#解锁钱包客户端" class="sidebar-link">解锁钱包客户端</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#导入现有钱包" class="sidebar-link">导入现有钱包</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#帐户升级成终身会员" class="sidebar-link">帐户升级成终身会员</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#帐户升级成出块会员" class="sidebar-link">帐户升级成出块会员</a></li></ul></li><li class="sidebar-sub-header"><a href="/installation/install.html#程式安装" class="sidebar-link">程式安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/installation/install.html#建立运行路径" class="sidebar-link">建立运行路径</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#复制节点执行档" class="sidebar-link">复制节点执行档</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#产生初始档案" class="sidebar-link">产生初始档案</a></li><li class="sidebar-sub-header"><a href="/installation/install.html#复制设定档" class="sidebar-link">复制设定档</a></li></ul></li><li class="sidebar-sub-header"><a href="/installation/install.html#出口-入口全节点" class="sidebar-link">出口/入口全节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/installation/install.html#代理服务器安装" class="sidebar-link">代理服务器安装</a></li></ul></li></ul></li><li><a href="/installation/setup.html" class="sidebar-link">节点设置</a></li><li><a href="/installation/startup.html" class="sidebar-link">节点启动</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="安装节点"><a href="#安装节点" aria-hidden="true" class="header-anchor">#</a> 安装节点</h1> <p>参与主神联盟链，提供出块/超级节点的公司，需要提供区块链节点所需的服务器以及频宽。本文基于「主神联盟链技术白皮书」所建议的部署架构，说明如何安装与设定联盟链程式。</p> <h2 id="部署架构"><a href="#部署架构" aria-hidden="true" class="header-anchor">#</a> 部署架构</h2> <p>逻辑上，虽然是一个联盟链的出块节点，但基于服务的可用性、安全性、扩充性，需要使用一组服务器以及相关网路服务。每组服务器部署在一个可用区(Availability Zone; AZ)或者数据中心(data center)；另外，为了网路存取控制，主机(服务器)被划分成 3 的子网路(subnet)，以及对应的安全领域(security domain)。</p> <p>下图呈现建议的网路架构：</p> <p><img src="/assets/img/figure-1.1.cd4a4b1d.png" alt="网路架构"></p> <h2 id="准备工作"><a href="#准备工作" aria-hidden="true" class="header-anchor">#</a> 准备工作</h2> <p>为了方便后续章节描述，下列表格定义之后会采用的变数名称以及定义：</p> <table><thead><tr><th>名称</th> <th>说明</th> <th>缺省值</th></tr></thead> <tbody><tr><td>$NODE_ROOT</td> <td>节点程式安装的路径</td> <td>/opt/zeus</td></tr> <tr><td>$NODE_DATA_DIR</td> <td>节点程式运行所需的数据</td> <td>$NODE_ROOT/witness_node_data_dir</td></tr> <tr><td>$SOURCE_PATH</td> <td>程式执行档以及设定档来源路径</td> <td>~/zeus</td></tr> <tr><td>$RPC_PORT</td> <td>RPC 的端口</td> <td>8090</td></tr> <tr><td>$P2P_PORT</td> <td>P2P 通讯用端口</td> <td>34567</td></tr></tbody></table> <p>安装过程需要有下列档案：</p> <table><thead><tr><th>档名</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>witness_node</td> <td>节点主程式</td> <td>支援 Ubuntu 16.06 x86_64</td></tr> <tr><td>cli_wallet</td> <td>钱包命令列介面</td> <td>建立以及管理帐户</td></tr> <tr><td>config.ini</td> <td>节点程序设定档</td> <td>范例档</td></tr> <tr><td>genesis.json</td> <td>区块链创世文件</td> <td></td></tr></tbody></table> <h3 id="主机需求"><a href="#主机需求" aria-hidden="true" class="header-anchor">#</a> 主机需求</h3> <table><thead><tr><th>规格名称</th> <th>规格说明</th> <th>适用主机</th></tr></thead> <tbody><tr><td>m4.4xlarge</td> <td>vCPU: 16 cores/RAM: 64GiB/SSD: 100GiB</td> <td>_ 主要出块节点<br> _ 备援出块节点</td></tr> <tr><td>m4.xlarge</td> <td>vCPU: 4 cores/RAM: 16GiB/SSD: 100GiB</td> <td>_ API 全节点<br> _ 出口全节点<br> * 入口全节点</td></tr></tbody></table> <h3 id="系统需求"><a href="#系统需求" aria-hidden="true" class="header-anchor">#</a> 系统需求</h3> <table><thead><tr><th>项目</th> <th>需求</th> <th>备注</th></tr></thead> <tbody><tr><td>操作系统(OS)</td> <td>Ubuntu 16.04</td> <td></td></tr></tbody></table> <h3 id="申请成为出块会员"><a href="#申请成为出块会员" aria-hidden="true" class="header-anchor">#</a> 申请成为出块会员</h3> <p>要申请成为出块会员，需要先有一个普通帐户。可以透过主神链发起方所提供的网页钱包建立一个普通帐户。有了普通帐户的名称与私钥，可以透过互操作命令介面 cli_wallet 申请成为出块会员。</p> <p>假设运维人员已经登入某台节点服务器，在终端机执行下列指令启动互操作介面：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cd</span> /opt/zeus
$ ./cli_wallet ws://<span class="token operator">&lt;</span>节点 IP 地址<span class="token operator">&gt;</span>:8090<span class="token punctuation">(</span>rpc port<span class="token punctuation">)</span>
</code></pre></div><p>其中，&lt;节点 IP 地址&gt; 是联盟链已经在执行的节点主机。
下面指令都是在 cli_wallet 的介面中执行。</p> <h3 id="解锁钱包客户端"><a href="#解锁钱包客户端" aria-hidden="true" class="header-anchor">#</a> 解锁钱包客户端</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>set_password <span class="token operator">&lt;</span>要创建的客户端密码<span class="token operator">&gt;</span>
unlock <span class="token operator">&lt;</span>客户端密码<span class="token operator">&gt;</span>
</code></pre></div><h3 id="导入现有钱包"><a href="#导入现有钱包" aria-hidden="true" class="header-anchor">#</a> 导入现有钱包</h3> <p>将现有帐户的私钥导入。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>import_key <span class="token operator">&lt;</span>帐户名<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>私钥<span class="token operator">&gt;</span>  <span class="token boolean">true</span>
</code></pre></div><p>导入成功后会更新钱包文件，可以透过 <code>list_my_accounts</code> 查看有哪些帐户。</p> <h3 id="帐户升级成终身会员"><a href="#帐户升级成终身会员" aria-hidden="true" class="header-anchor">#</a> 帐户升级成终身会员</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>upgrade_account <span class="token operator">&lt;</span>帐户名<span class="token operator">&gt;</span> <span class="token boolean">true</span> <span class="token boolean">true</span>
</code></pre></div><h3 id="帐户升级成出块会员"><a href="#帐户升级成出块会员" aria-hidden="true" class="header-anchor">#</a> 帐户升级成出块会员</h3> <p>升级成出块会员需要消耗虚拟币。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>create_witness <span class="token operator">&lt;</span>帐户名<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>推广网站<span class="token operator">&gt;</span> <span class="token boolean">true</span>
</code></pre></div><p>其中，&lt; 推广网站&gt;是合作方提供推广信息用的网址。</p> <h2 id="程式安装"><a href="#程式安装" aria-hidden="true" class="header-anchor">#</a> 程式安装</h2> <p>节点主机都需要按照下列各节描述的步骤安装节点程式。
安装相依套件</p> <p>节点需要执行环境预先安装有相关的系统套件，在命令列中使用下列指令安装：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libbz2-dev libdb++-dev \
libdb-dev libssl-dev openssl \
 libreadline-dev libtool libcurl4-openssl-dev \
 libcurl4-openssl-dev libboost-all-dev
</code></pre></div><p>$ 为命令提示符号，不用输入。
建立运行路径
$ mkdir -p /opt/zeus</p> <h3 id="建立运行路径"><a href="#建立运行路径" aria-hidden="true" class="header-anchor">#</a> 建立运行路径</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> -p /opt/zeus
</code></pre></div><h3 id="复制节点执行档"><a href="#复制节点执行档" aria-hidden="true" class="header-anchor">#</a> 复制节点执行档</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cp</span> <span class="token variable">$SOURCE_PATH</span>/witness_node <span class="token variable">$NODE_ROOT</span>/
$ <span class="token function">chmod</span> a+x <span class="token variable">$NODE_ROOT</span>/witness_node
</code></pre></div><h3 id="产生初始档案"><a href="#产生初始档案" aria-hidden="true" class="header-anchor">#</a> 产生初始档案</h3> <p>节点程式数据路径需要初始化，执行下列指令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ chdir <span class="token variable">$NODE_ROOT</span>
$ ./witness_node
</code></pre></div><p>上述会在 $NODE_ROOT 路径中产生一个 <code>witness_node_data_dir</code> 子路径，这个目录就是 $NODE_DATA_DIR 。</p> <h3 id="复制设定档"><a href="#复制设定档" aria-hidden="true" class="header-anchor">#</a> 复制设定档</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cp</span> <span class="token variable">$SOURCE_PATH</span>/config.ini <span class="token variable">$NODE_DATA_DIR</span>/
</code></pre></div><p>这个设定档提供缺省或者建议的设定值，实际运行需要调整的设定在「程式设定」这一章说明。</p> <h2 id="出口-入口全节点"><a href="#出口-入口全节点" aria-hidden="true" class="header-anchor">#</a> 出口/入口全节点</h2> <h3 id="代理服务器安装"><a href="#代理服务器安装" aria-hidden="true" class="header-anchor">#</a> 代理服务器安装</h3> <ol><li>安装软件</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> add-apt-repository ppa:nginx/stable
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y nginx-extras
</code></pre></div><ol start="2"><li>基本环境设定</li></ol> <p>编辑主要设定档 <code>/etc/nginx/nginx.conf</code>， 搜寻 ”include /etc/nginx/conf.d/<em>.conf;”，将 ”include /etc/nginx/conf.d/</em>.conf;”，移出 http { } 区块外。</p> <p>新增设定档 <code>/etc/nginx/conf.d/ingress.conf</code>，内容如下(IP 位址与端口根据环境修改)))：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>stream <span class="token punctuation">{</span>
    <span class="token keyword">upstream</span> mtningress <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">10.3</span><span class="token number">.4</span><span class="token number">.11</span><span class="token punctuation">:</span><span class="token number">34567</span><span class="token punctuation">;</span> <span class="token comment">##本地端入口节点</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">server</span> <span class="token punctuation">{</span>

        <span class="token keyword">listen</span> <span class="token number">35789</span> <span class="token keyword">ssl</span><span class="token punctuation">;</span>
        <span class="token keyword">tcp_nodelay</span> on<span class="token punctuation">;</span>
        <span class="token keyword">proxy_pass</span> mtningress<span class="token punctuation">;</span>
        <span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span>zeusCA<span class="token operator">/</span>motion<span class="token punctuation">.</span>one<span class="token punctuation">.</span>crt<span class="token punctuation">;</span> <span class="token comment">##入口节点证书</span>
        <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span>zeusCA<span class="token operator">/</span>motion<span class="token punctuation">.</span>one<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">##入口节点私钥</span>
        <span class="token keyword">ssl_client_certificate</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span>zeusCA<span class="token operator">/</span>ca<span class="token punctuation">.</span>crt<span class="token punctuation">;</span> <span class="token comment">## 本地节点root CA，外部节点连线必须基于此CA产出Client证书</span>
        <span class="token keyword">ssl_protocols</span> TLSv1 TLSv1<span class="token punctuation">.</span><span class="token number">1</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">ssl_ciphers</span> HIGH<span class="token punctuation">:</span><span class="token operator">!</span>aNULL<span class="token punctuation">:</span><span class="token operator">!</span>MD5<span class="token punctuation">;</span>
        <span class="token keyword">ssl_verify_client</span> on<span class="token punctuation">;</span> <span class="token comment">## 开启连线客户端证书认证</span>
        <span class="token keyword">ssl_session_cache</span>     shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span><span class="token number">20</span>m<span class="token punctuation">;</span>
        <span class="token keyword">ssl_session_timeout</span>   <span class="token number">4</span>h<span class="token punctuation">;</span>
        ssl_handshake_timeout <span class="token number">30</span>s<span class="token punctuation">;</span>
        <span class="token keyword">proxy_connect_timeout</span> <span class="token number">7</span>d<span class="token punctuation">;</span>
        <span class="token keyword">allow</span> xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>xxx<span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">;</span> <span class="token comment">##外部连入本地节点来源IP</span>
        <span class="token keyword">deny</span> all<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>新增 Engress 设定档 <code>/etc/nginx/conf.d/engress.conf</code>，内容如下：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>stream <span class="token punctuation">{</span>
    <span class="token keyword">upstream</span> mtnengress <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">18.182</span><span class="token number">.93</span><span class="token number">.83</span><span class="token punctuation">:</span><span class="token number">35789</span><span class="token punctuation">;</span> <span class="token comment">###联盟主炼入口节点 1</span>
        <span class="token keyword">server</span> <span class="token number">18.182</span><span class="token number">.82</span><span class="token number">.151</span><span class="token punctuation">:</span><span class="token number">35789</span><span class="token punctuation">;</span> <span class="token comment">###联盟主炼入口节点 2</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">server</span> <span class="token punctuation">{</span>

        <span class="token keyword">listen</span> <span class="token number">35789</span><span class="token punctuation">;</span> <span class="token comment">#本地出口用端口，用来连线到联盟主链</span>
        <span class="token keyword">proxy_pass</span> mtnengress<span class="token punctuation">;</span>
        proxy_ssl on<span class="token punctuation">;</span>
        proxy_ssl_certificate <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span>zeusCA<span class="token operator">/</span>chain<span class="token operator">-</span>client<span class="token punctuation">.</span>crt<span class="token punctuation">;</span> <span class="token comment">##联盟主链提供公钥证书</span>
        proxy_ssl_certificate_key <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span>zeusCA<span class="token operator">/</span>cgain<span class="token operator">-</span>client<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">##提供给联盟主链产生证书私钥</span>
        proxy_ssl_protocols TLSv1 TLSv1<span class="token punctuation">.</span><span class="token number">1</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">;</span>
        proxy_ssl_ciphers HIGH<span class="token punctuation">:</span><span class="token operator">!</span>aNULL<span class="token punctuation">:</span><span class="token operator">!</span>MD5<span class="token punctuation">;</span>
        proxy_ssl_verify_depth <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_ssl_session_reuse</span> on<span class="token punctuation">;</span>
        <span class="token keyword">allow</span> <span class="token number">10.3</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">;</span>
        <span class="token keyword">deny</span> all<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>连线用 SSL 证书核发</li></ol> <p><strong>OpenSSL 环境变数修改</strong>
编辑 <code>/usr/lib/ssl/openssl.cnf</code>档案</p> <div class="language- extra-class"><pre class="language-text"><code>[ CA_default ]

dir             = /opt/ssl/zeusCA               # Where everything is kept
certs           = $dir/certs            # Where the issued certs are kept
crl_dir         = $dir/crl              # Where the issued crl are kept
database        = $dir/index.txt        # database index file.
#unique_subject = no                    # Set to 'no' to allow creation of
                                        # several ctificates with same subject.
new_certs_dir   = $dir/newcerts         # default place for new certs.

certificate     = $dir/cacert.pem       # The CA certificate
serial          = $dir/serial           # The current serial number
crlnumber       = $dir/crlnumber        # the current crl number
                                        # must be commented out to leave a V1 CRL
crl             = $dir/crl.pem          # The current CRL
private_key     = $dir/private/cakey.pem# The private key
RANDFILE        = $dir/private/.rand    # private random number file
</code></pre></div><p><strong>建立核发目录</strong></p> <div class="language- extra-class"><pre class="language-text"><code>$ mkdir -p /opt/ssl/zeusCA/newcerts
$ mkdir -p /opt/ssl/zeusCA/private
$ cd /opt/ssl/zeusCA
$ touch index.txt
$ echo ‘01’ &gt; serial
</code></pre></div><p><strong>建立 Root CA</strong></p> <p>建立Root CA私钥</p> <div class="language- extra-class"><pre class="language-text"><code>$ openssl genrsa -des3 -out ca.key 2048
</code></pre></div><p>产生无密码私钥</p> <div class="language- extra-class"><pre class="language-text"><code>$ openssl rsa -in ca.key -out ca_decrypted.key
</code></pre></div><p>产生公钥</p> <div class="language- extra-class"><pre class="language-text"><code>$ openssl req -new -x509 -days 18250 -key ca.key -out ca.crt
</code></pre></div><p><strong>建立连线证书</strong></p> <div class="language- extra-class"><pre class="language-text"><code>建立连线用证书私钥
$ openssl genrsa -des3 -out motion.one.pem 2048

产生无密码私钥
$ openssl rsa -in motion.one.pem -out motion.one.key

产生签名档
$ openssl req -new -key motion.one.pem -out motion.one.csr

</code></pre></div><p><strong>连线证书签署</strong></p> <p>签署证书</p> <div class="language- extra-class"><pre class="language-text"><code>$ openssl ca -policy policy_anything -days 7300 -cert ca.crt -keyfile ca.key -in motion.one.csr -out motion.one.crt
</code></pre></div><p>追加 Root CA 内容</p> <div class="language- extra-class"><pre class="language-text"><code>cat ca.crt&gt;&gt; motion.one.crt
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/installation/" class="prev router-link-active">
          节点安装手册
        </a></span> <span class="next"><a href="/installation/setup.html">
          节点设置
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/15.ea1ac61f.js" defer></script><script src="/assets/js/app.295daaac.js" defer></script>
  </body>
</html>
